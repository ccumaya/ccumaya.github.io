<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-5007622-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-5007622-2');
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script>
        $(function(){
            //$('#oldLink').on("change keyup paste", function() {
            $('#oldLink').on("paste", function(e) {
                //var currentVal = $(this).val().trim();
                //let currentVal = $('#oldLink').val().trim();
                //無法直接取得paste的內容，需用奇怪方法
                //https://stackoverflow.com/questions/11605415/jquery-bind-to-paste-event-how-to-get-the-content-of-the-paste/11605419
                var currentVal = e.originalEvent.clipboardData.getData('text');

                //新格式
                //https://wavelive.onelink.me/tEt5?pid=deeplink_replay&c=deeplink_replay&w_play=6284566b-3f58-4b84-adba-665870f8d61d&is_retargeting=true&af_dp=wavelive%3A%2F%2F
                //舊格式
                //https://wave.com.tw/plays/6284566b-3f58-4b84-adba-665870f8d61d

                let githubURL = new URL(currentVal);
                //let githubURL = new URL('https://wavelive.onelink.me/tEt5?pid=deeplink_replay&c=deeplink_replay&w_play=6284566b-3f58-4b84-adba-665870f8d61d&is_retargeting=true&af_dp=wavelive%3A%2F%2F');
                let params = githubURL.searchParams;
                let guid = params.get('w_play');

                if(guid.length === 36)
                {
                    let newUrl = 'https://wave.com.tw/plays/'+ guid;
                    $('#spChg').html('<a href="' + newUrl + '" target="_blank">請點這邊</a>');
                }

                //let idxPlay = currentVal


            });
        });

    </script>

</head>
    <body>

        貼上分享的wave網址：<br />
        <textarea id='oldLink' cols="250" rows="5"></textarea>

        <span id='spChg'></span>

    </body>
</html>